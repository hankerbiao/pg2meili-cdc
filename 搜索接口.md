### 搜索接口

#### 接口概览

- 接口地址：`POST /search`
- 基础域名：`http://<gateway-host>:8091`（示例使用 `http://localhost:8091`）
- 协议：HTTPS/HTTP
- 鉴权方式：`Authorization: Bearer <JWT>`（应用级访问令牌）
- 数据格式：`Content-Type: application/json`

#### 公共请求头

- `Authorization`：必填，格式 `Bearer <JWT>`，用于标识调用方应用（`app_name`）
- `Content-Type`：必填，`application/json`

#### 请求体参数

请求体为原样透传到 Meilisearch `POST /indexes/{index}/search` 的 JSON 对象，常用字段如下：

- `q`：字符串，搜索关键字，示例 `"电源"`
- `offset`：整数，可选，起始偏移量，用于分页
- `limit`：整数，可选，返回条数
- `filter`：字符串或数组，可选，过滤条件，例如 `tags = "BMC"`
- `attributesToHighlight`：数组，可选，需要高亮的字段列表，例如 `["*"]`

> 说明：索引名称由后端根据 JWT 中的 `app_name` 和配置的基础索引名自动拼接，客户端无需在请求体中指定索引。

#### 响应结果

接口返回 Meilisearch 原始搜索结果，主要字段包括：

- `hits`：文档数组，每个元素为一条命中的测试用例
- `hits[i].id`：用例内部 ID
- `hits[i].ext_id`：外部用例编号，例如 `BMC-114245`
- `hits[i].name`：用例名称
- `hits[i].summary`：用例摘要
- `hits[i].tags`：标签数组，例如 `["BMC issue", "AMD", "Intel"]`
- `hits[i]._formatted`：可选，高亮后的字段结果
  - `hits[i]._formatted.name`
  - `hits[i]._formatted.summary`

---

### 使用示例

#### 1. 简单关键字搜索

**请求示例（curl）**

```bash
curl -X POST "http://localhost:8091/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <YOUR_JWT>" \
  --data-raw '{
    "q": "电源"
  }'
```

**请求示例（JavaScript，fetch）**

```js
const BASE_URL = "http://localhost:8091";
const token = "<YOUR_JWT>";

async function searchSimple() {
  const resp = await fetch(`${BASE_URL}/search`, {
    method: "POST",
    headers: {
      Authorization: `Bearer ${token}`,
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      q: "电源",
    }),
  });
  if (!resp.ok) {
    throw new Error(`HTTP ${resp.status}`);
  }
  const data = await resp.json();
  console.log("hits:", data.hits);
}
```

---

#### 2. 高亮搜索（attributesToHighlight）

**请求示例（curl）**

```bash
curl -X POST "http://localhost:8091/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <YOUR_JWT>" \
  --data-raw '{
    "q": "电源",
    "attributesToHighlight": ["*"]
  }'
```

**请求示例（JavaScript，fetch）**

```js
async function searchWithHighlight() {
  const resp = await fetch(`${BASE_URL}/search`, {
    method: "POST",
    headers: {
      Authorization: `Bearer ${token}`,
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      q: "电源",
      attributesToHighlight: ["*"],
    }),
  });
  const data = await resp.json();
  const hits = data.hits || [];
  if (hits.length > 0) {
    const doc = hits[0];
    console.log("name:", doc.name);
    console.log("summary:", doc.summary);
    if (doc._formatted) {
      console.log("highlighted name:", doc._formatted.name);
      console.log("highlighted summary:", doc._formatted.summary);
    }
  }
}
```

---

#### 3. 按标签过滤搜索

**请求示例（curl）**

```bash
curl -X POST "http://localhost:8091/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <YOUR_JWT>" \
  --data-raw '{
    "q": "电源",
    "filter": ["tags = \"BMC\""]
  }'
```

**请求示例（JavaScript，fetch）**

```js
async function searchFilterByTag() {
  const resp = await fetch(`${BASE_URL}/search`, {
    method: "POST",
    headers: {
      Authorization: `Bearer ${token}`,
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      q: "电源",
      filter: ['tags = "BMC"'],
    }),
  });
  const data = await resp.json();
  console.log("hits:", data.hits);
}
```

---

#### 4. 分页搜索

**请求示例（curl）**

```bash
curl -X POST "http://localhost:8091/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <YOUR_JWT>" \
  --data-raw '{
    "q": "电源",
    "offset": 0,
    "limit": 5
  }'
```

**请求示例（JavaScript，fetch）**

```js
async function searchWithPagination(page = 1, pageSize = 5) {
  const offset = (page - 1) * pageSize;
  const resp = await fetch(`${BASE_URL}/search`, {
    method: "POST",
    headers: {
      Authorization: `Bearer ${token}`,
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      q: "电源",
      offset,
      limit: pageSize,
    }),
  });
  const data = await resp.json();
  console.log(`page=${page} hits:`, data.hits);
}
```

